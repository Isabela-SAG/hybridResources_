<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Matching de Candidatos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        input, textarea, button { margin: 0.5em 0; width: 100%; }
        .result { margin-top: 2em; }
        .card { border: 1px solid #ccc; padding: 1em; margin-bottom: 1em; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Matching de Candidatos</h1>

    <h2>Buscar candidatos para uma vaga (texto)</h2>
    <form id="form-text">
        <textarea id="descricao" rows="4" placeholder="Descreva a vaga..."></textarea>
        <button type="submit">Buscar candidatos</button>
    </form>
    <div id="result-text" class="result"></div>

    <hr>

    <h2>Buscar candidatos para v√°rias vagas (upload JSON)</h2>
    <form id="form-file" enctype="multipart/form-data">
        <input type="file" id="vagas-file" accept=".json" />
        <button type="submit">Buscar candidatos</button>
    </form>
    <div id="result-file" class="result"></div>

    <script>
        // Rota /match_text
        document.getElementById('form-text').onsubmit = async function(e) {
            e.preventDefault();
            const descricao = document.getElementById('descricao').value;
            const formData = new FormData();
            formData.append('descricao', descricao);

            const res = await fetch('/match_text', {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            let html = `<h3>Top candidatos para a vaga:</h3>`;
            if (data.top_candidatos) {
                data.top_candidatos.forEach(c => {
                    html += `<div class="card"><b>Candidato:</b> ${c.candidato}<br><b>Score:</b> ${c.score.toFixed(2)}</div>`;
                });
            } else {
                html += `<div>${JSON.stringify(data)}</div>`;
            }
            document.getElementById('result-text').innerHTML = html;
        };

        // Rota /match (upload de arquivo)
        document.getElementById('form-file').onsubmit = async function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('vagas-file');
            if (!fileInput.files.length) return;
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const res = await fetch('/match', {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            let html = `<h3>Top candidatos por vaga:</h3>`;
            if (data.top_matches) {
                data.top_matches.forEach(vaga => {
                    html += `<div class="card"><b>Vaga:</b> ${vaga.vaga}<ul>`;
                    vaga.top_candidatos.forEach(c => {
                        html += `<li><b>Candidato:</b> ${c.candidato} | <b>Score:</b> ${c.score.toFixed(2)}</li>`;
                    });
                    html += `</ul></div>`;
                });
            } else {
                html += `<div>${JSON.stringify(data)}</div>`;
            }
            document.getElementById('result-file').innerHTML = html;
        };
    </script>
</body>
</html>